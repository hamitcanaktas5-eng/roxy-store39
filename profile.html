<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Profil - Roxy Store</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap');
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
:root{--p:#00D9FF;--s:#A855F7;--g:#00FF88;--dark:#0A0A0F;--d2:#12121A;--d3:#1A1A28;--border:rgba(0,217,255,.12);--muted:#A0A0B8;--err:#FF6584;--warn:#FFB347;}
body{font-family:'Poppins',sans-serif;background:var(--dark);color:#fff;overflow-x:hidden;min-height:100vh;}
/* ANA PROFİL */
.cover{height:200px;background:linear-gradient(135deg,#0A0A0F 0%,rgba(0,217,255,.15) 50%,rgba(168,85,247,.15) 100%);position:relative;overflow:hidden;}
.cover::after{content:'';position:absolute;inset:0;background:url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2300D9FF' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");}
.btn-geri{position:absolute;top:16px;left:16px;display:flex;align-items:center;gap:8px;padding:9px 14px;background:rgba(26,26,40,.9);border:1.5px solid rgba(0,217,255,.2);border-radius:10px;color:#fff;text-decoration:none;font-size:13px;font-weight:600;cursor:pointer;transition:.2s;z-index:5;border:none;}
.btn-geri:hover{border-color:var(--p);color:var(--p);}
.avatar-wrap{position:relative;display:inline-block;margin-top:-56px;margin-left:24px;}
.avatar-wrap img{width:112px;height:112px;border-radius:50%;border:4px solid var(--dark);box-shadow:0 0 0 4px rgba(0,217,255,.3);}
.profile-info{padding:12px 24px 24px;}
.profile-name{font-size:22px;font-weight:800;margin-bottom:4px;}
.profile-email{font-size:13px;color:var(--muted);margin-bottom:8px;}
.profile-badge{display:inline-flex;align-items:center;gap:6px;padding:5px 12px;background:rgba(0,255,136,.1);border:1px solid rgba(0,255,136,.2);border-radius:20px;font-size:12px;color:var(--g);}
/* BALANCE CARD */
.bal-card{margin:0 24px 20px;background:linear-gradient(135deg,rgba(0,217,255,.12),rgba(168,85,247,.12));border:1.5px solid rgba(0,217,255,.22);border-radius:16px;padding:18px 20px;display:flex;align-items:center;justify-content:space-between;}
.bal-card-left{display:flex;align-items:center;gap:14px;}
.bal-card-ico{width:44px;height:44px;background:rgba(0,217,255,.15);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--p);}
.bal-card-lbl{font-size:12px;color:var(--muted);display:block;}
.bal-card-val{font-size:22px;font-weight:900;color:var(--p);}
.btn-load-small{padding:10px 16px;background:linear-gradient(135deg,var(--p),var(--s));border:none;border-radius:10px;color:#0A0A0F;font-family:'Poppins',sans-serif;font-weight:700;font-size:13px;cursor:pointer;transition:.2s;}
.btn-load-small:hover{opacity:.9;}
/* MENÜ */
.menu-section{margin:0 24px 20px;}
.menu-sec-title{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;font-weight:700;margin-bottom:10px;}
.menu-item{display:flex;align-items:center;justify-content:space-between;padding:16px 18px;background:var(--d3);border:1.5px solid var(--border);border-radius:14px;margin-bottom:8px;cursor:pointer;transition:.2s;width:100%;}
.menu-item:hover{border-color:rgba(0,217,255,.25);transform:translateY(-1px);}
.menu-item-left{display:flex;align-items:center;gap:14px;}
.menu-ico{width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:17px;}
.ico-blue{background:rgba(0,217,255,.12);color:var(--p);}
.ico-green{background:rgba(0,255,136,.12);color:var(--g);}
.ico-red{background:rgba(255,101,132,.12);color:var(--err);}
.ico-warn{background:rgba(255,179,71,.12);color:var(--warn);}
.menu-label{font-size:14px;font-weight:600;}
.menu-sub{font-size:12px;color:var(--muted);display:block;margin-top:2px;}
.btn-logout{display:flex;align-items:center;justify-content:center;gap:10px;width:calc(100% - 48px);margin:0 24px 32px;padding:15px;background:rgba(255,101,132,.1);border:1.5px solid rgba(255,101,132,.25);border-radius:14px;color:var(--err);font-family:'Poppins',sans-serif;font-weight:700;font-size:15px;cursor:pointer;transition:.2s;}
.btn-logout:hover{background:rgba(255,101,132,.2);}
/* ŞİFRE PANELİ */
#pwPanel{position:fixed;inset:0;background:var(--dark);z-index:500;overflow-y:auto;display:none;}
.panel-topbar{background:rgba(26,26,40,.98);border-bottom:1px solid var(--border);padding:0 20px;height:62px;display:flex;align-items:center;gap:14px;position:sticky;top:0;}
.back-btn{background:transparent;border:none;color:var(--p);font-size:20px;cursor:pointer;padding:8px;border-radius:8px;}
.panel-title{font-size:17px;font-weight:800;}
.pw-content{max-width:560px;margin:0 auto;padding:28px 20px;}
.field{margin-bottom:18px;}
.field-label{font-size:12px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;display:block;margin-bottom:10px;}
.inp-wrap{position:relative;}
.inp{width:100%;padding:14px 46px 14px 16px;background:var(--d2);border:1.5px solid rgba(255,255,255,.08);border-radius:12px;color:#fff;font-family:'Poppins',sans-serif;font-size:14px;outline:none;transition:border .2s;}
.inp:focus{border-color:var(--p);}
.eye-btn{position:absolute;right:14px;top:50%;transform:translateY(-50%);background:transparent;border:none;color:var(--muted);cursor:pointer;font-size:15px;}
.eye-btn:hover{color:var(--p);}
.pw-reqs{display:none;background:rgba(255,255,255,.04);border-radius:10px;padding:12px 14px;margin-top:8px;}
.pw-reqs.show{display:block;}
.req{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--muted);margin-bottom:4px;}
.req.ok{color:var(--g);}
.match-hint{font-size:12px;margin-top:6px;display:block;}
.match-hint.ok{color:var(--g);} .match-hint.err{color:var(--err);}
.rate-info{background:rgba(255,179,71,.07);border:1px solid rgba(255,179,71,.2);border-radius:10px;padding:12px 14px;font-size:13px;color:var(--muted);display:flex;align-items:center;gap:8px;margin-bottom:18px;}
.rate-info i{color:var(--warn);flex-shrink:0;}
.btn-save{width:100%;display:flex;align-items:center;justify-content:center;gap:10px;padding:16px;background:linear-gradient(135deg,var(--p),var(--s));border:none;border-radius:13px;color:#0A0A0F;font-family:'Poppins',sans-serif;font-weight:800;font-size:16px;cursor:pointer;transition:.2s;}
.btn-save:disabled{opacity:.35;cursor:not-allowed;}
</style>
</head>
<body>

<!-- ANA EKRAN -->
<div id="profileMain">
  <div class="cover">
    <button class="btn-geri" onclick="window.location.href='dashboard.html'"><i class="fas fa-arrow-left"></i> Dashboard</button>
  </div>
  <div class="avatar-wrap">
    <img id="profileAvatar" src="https://ui-avatars.com/api/?name=U&background=00D9FF&color=fff&size=200" alt="">
  </div>
  <div class="profile-info">
    <div class="profile-name" id="profileName">Yükleniyor...</div>
    <div class="profile-email" id="profileEmail">—</div>
    <span class="profile-badge"><i class="fas fa-check-circle"></i> Doğrulanmış Hesap</span>
  </div>

  <div class="bal-card">
    <div class="bal-card-left">
      <div class="bal-card-ico"><i class="fas fa-wallet"></i></div>
      <div><span class="bal-card-lbl">Mevcut Bakiye</span><span class="bal-card-val" id="profileBal">0 ₺</span></div>
    </div>
    <button class="btn-load-small" onclick="window.location.href='balance.html'"><i class="fas fa-plus"></i> Yükle</button>
  </div>

  <div class="menu-section">
    <div class="menu-sec-title">Hesabım</div>
    <button class="menu-item" onclick="openPwPanel()">
      <div class="menu-item-left">
        <div class="menu-ico ico-blue"><i class="fas fa-lock"></i></div>
        <div><div class="menu-label">Şifre Değiştir</div><span class="menu-sub">Hesap güvenliğinizi güncelleyin</span></div>
      </div>
      <i class="fas fa-chevron-right" style="color:var(--muted)"></i>
    </button>
    <a href="support.html" class="menu-item" style="text-decoration:none;color:inherit;">
      <div class="menu-item-left">
        <div class="menu-ico ico-green"><i class="fas fa-headset"></i></div>
        <div><div class="menu-label">Destek</div><span class="menu-sub">Yardım alın</span></div>
      </div>
      <i class="fas fa-chevron-right" style="color:var(--muted)"></i>
    </a>
  </div>

  <button class="btn-logout" onclick="doLogout()"><i class="fas fa-sign-out-alt"></i> Çıkış Yap</button>
</div>

<!-- ŞİFRE PANELİ -->
<div id="pwPanel">
  <div class="panel-topbar">
    <button class="back-btn" onclick="closePwPanel()"><i class="fas fa-arrow-left"></i></button>
    <span class="panel-title">Şifre Değiştir</span>
  </div>
  <div class="pw-content">
    <div class="rate-info"><i class="fas fa-info-circle"></i> Şifrenizi haftada 1 kez değiştirebilirsiniz.</div>
    <div class="field">
      <span class="field-label">Mevcut Şifre</span>
      <div class="inp-wrap">
        <input type="password" class="inp" id="oldPw" placeholder="Mevcut şifreniz" oninput="checkPwForm()">
        <button class="eye-btn" onclick="toggleEye('oldPw',this)"><i class="fas fa-eye"></i></button>
      </div>
    </div>
    <div class="field">
      <span class="field-label">Yeni Şifre</span>
      <div class="inp-wrap">
        <input type="password" class="inp" id="newPw" placeholder="Yeni şifreniz" oninput="onNewPwInput()">
        <button class="eye-btn" onclick="toggleEye('newPw',this)"><i class="fas fa-eye"></i></button>
      </div>
      <div class="pw-reqs" id="pwReqs">
        <div class="req" id="rLen"><i class="fas fa-times-circle"></i> En az 8 karakter</div>
        <div class="req" id="rUp"><i class="fas fa-times-circle"></i> Büyük harf (A-Z)</div>
        <div class="req" id="rLow"><i class="fas fa-times-circle"></i> Küçük harf (a-z)</div>
        <div class="req" id="rNum"><i class="fas fa-times-circle"></i> Rakam (0-9)</div>
      </div>
    </div>
    <div class="field">
      <span class="field-label">Yeni Şifre Tekrar</span>
      <div class="inp-wrap">
        <input type="password" class="inp" id="confPw" placeholder="Yeni şifrenizi tekrar girin" oninput="checkPwForm()">
        <button class="eye-btn" onclick="toggleEye('confPw',this)"><i class="fas fa-eye"></i></button>
      </div>
      <span class="match-hint" id="matchHint"></span>
    </div>
    <div style="background:rgba(255,101,132,.08);border:1px solid rgba(255,101,132,.15);border-radius:10px;padding:12px 14px;font-size:13px;color:var(--muted);display:flex;align-items:center;gap:8px;margin-bottom:20px;">
      <i class="fas fa-exclamation-triangle" style="color:var(--err);flex-shrink:0"></i>
      <span id="pwErrMsg" style="color:var(--err);display:none;"></span>
      <span id="pwInfoMsg">Şifrenizi girintikten sonra "Güncelle" butonuna basın.</span>
    </div>
    <button class="btn-save" id="btnSavePw" onclick="savePw()" disabled><i class="fas fa-check"></i> Şifreyi Güncelle</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
var _app=firebase.apps.length?firebase.apps[0]:firebase.initializeApp({apiKey:"AIzaSyBf2A1GhEzruI_6lfCNbq4MsbU8hxFjoqI",authDomain:"roxy-store-67c53.firebaseapp.com",projectId:"roxy-store-67c53",storageBucket:"roxy-store-67c53.firebasestorage.app",messagingSenderId:"450502544206",appId:"1:450502544206:web:502d0200dc35ecacfc2c1f"});
var auth=firebase.auth(),db=firebase.firestore();
var _user=null;

function formatPrice(n){return Math.round(n||0).toLocaleString('tr-TR')+' ₺';}

var RoxyUI={
  toast:function(msg,type,dur){dur=dur||3500;var c={success:'#00FF88',error:'#FF6584',warning:'#FFB347',info:'#00D9FF'};var ic={success:'check-circle',error:'times-circle',warning:'exclamation-triangle',info:'info-circle'};var w=document.getElementById('_rt');if(!w){w=document.createElement('div');w.id='_rt';w.style.cssText='position:fixed;bottom:24px;right:24px;z-index:99999;display:flex;flex-direction:column;gap:10px;max-width:360px;';document.body.appendChild(w);}var t=document.createElement('div');t.style.cssText='display:flex;align-items:center;gap:12px;padding:14px 18px;background:#1F1F2E;border:1.5px solid '+(c[type]||c.info)+';border-radius:14px;font-family:Poppins,sans-serif;font-size:14px;color:#fff;box-shadow:0 8px 32px rgba(0,0,0,.5);';t.innerHTML='<i class="fas fa-'+(ic[type]||'info-circle')+'" style="color:'+(c[type]||c.info)+';font-size:18px;flex-shrink:0"></i><span>'+msg+'</span>';w.appendChild(t);setTimeout(function(){t.style.transition='.3s';t.style.opacity='0';t.style.transform='translateY(8px)';setTimeout(function(){t.remove();},300);},dur);},
  confirm:function(title,msg,ok,cancel,danger){return new Promise(function(resolve){var ov=document.createElement('div');ov.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:99998;display:flex;align-items:center;justify-content:center;padding:16px;';ov.innerHTML='<div style="background:#1A1A28;border:1.5px solid rgba(0,217,255,.2);border-radius:20px;padding:36px 30px;max-width:420px;width:100%;text-align:center;font-family:Poppins,sans-serif;"><i class="fas fa-question-circle" style="font-size:48px;color:#00D9FF;display:block;margin-bottom:14px;"></i><div style="font-size:19px;font-weight:800;margin-bottom:10px;">'+title+'</div><div style="font-size:14px;color:#A0A0B8;line-height:1.7;margin-bottom:26px;">'+msg+'</div><div style="display:flex;gap:12px;justify-content:center;"><button id="_rC" style="padding:12px 24px;background:transparent;border:1.5px solid rgba(255,255,255,.15);border-radius:12px;color:#A0A0B8;font-weight:700;cursor:pointer;font-family:Poppins,sans-serif;">'+(cancel||'İptal')+'</button><button id="_rO" style="padding:12px 24px;background:'+(danger?'linear-gradient(135deg,#FF6584,#c0392b)':'linear-gradient(135deg,#00D9FF,#A855F7)')+';border:none;border-radius:12px;color:#0A0A0F;font-weight:800;cursor:pointer;font-family:Poppins,sans-serif;">'+(ok||'Onayla')+'</button></div></div>';document.body.appendChild(ov);ov.querySelector('#_rO').onclick=function(){ov.remove();resolve(true);};ov.querySelector('#_rC').onclick=function(){ov.remove();resolve(false);};})}
};

var _unsub=auth.onAuthStateChanged(function(user){
  _unsub();
  if(!user){window.location.href='auth.html';return;}
  _user=user;
  db.collection('users').doc(user.uid).get().then(function(s){
    var d=s.exists?s.data():{};
    var n=d.name||user.displayName||'Kullanıcı';
    document.getElementById('profileName').textContent=n;
    document.getElementById('profileEmail').textContent=user.email;
    document.getElementById('profileBal').textContent=formatPrice(d.balance||0);
    document.getElementById('profileAvatar').src='https://ui-avatars.com/api/?name='+encodeURIComponent(n)+'&background=00D9FF&color=fff&size=200';
  });
});

function doLogout(){
  RoxyUI.confirm('Çıkış Yap','Hesabınızdan çıkış yapmak istiyor musunuz?','Çıkış Yap','İptal',true)
    .then(function(ok){if(ok)auth.signOut().then(function(){window.location.href='auth.html';});});
}

function openPwPanel(){document.getElementById('pwPanel').style.display='block';document.body.style.overflow='hidden';}
function closePwPanel(){document.getElementById('pwPanel').style.display='none';document.body.style.overflow='';}

function toggleEye(id,btn){var i=document.getElementById(id);var s=i.type==='text';i.type=s?'password':'text';btn.innerHTML='<i class="fas fa-'+(s?'eye':'eye-slash')+'"></i>';}

function onNewPwInput(){
  var v=document.getElementById('newPw').value;
  document.getElementById('pwReqs').classList.add('show');
  var checks={rLen:v.length>=8,rUp:/[A-Z]/.test(v),rLow:/[a-z]/.test(v),rNum:/[0-9]/.test(v)};
  Object.keys(checks).forEach(function(id){
    var el=document.getElementById(id);el.classList.toggle('ok',checks[id]);
    el.querySelector('i').className='fas fa-'+(checks[id]?'check-circle':'times-circle');
  });
  checkPwForm();
}

function checkPwForm(){
  var o=document.getElementById('oldPw').value;
  var n=document.getElementById('newPw').value;
  var c=document.getElementById('confPw').value;
  var mh=document.getElementById('matchHint');
  if(c){if(n===c){mh.className='match-hint ok';mh.textContent='✓ Şifreler eşleşiyor';}else{mh.className='match-hint err';mh.textContent='⚠ Şifreler eşleşmiyor';}}
  else{mh.textContent='';}
  var pwOk=n.length>=8&&/[A-Z]/.test(n)&&/[a-z]/.test(n)&&/[0-9]/.test(n);
  document.getElementById('btnSavePw').disabled=!(o&&pwOk&&n===c);
}

function savePw(){
  var old=document.getElementById('oldPw').value;
  var nw=document.getElementById('newPw').value;
  var btn=document.getElementById('btnSavePw');
  btn.disabled=true;btn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Güncelleniyor...';
  var cred=firebase.auth.EmailAuthProvider.credential(_user.email,old);
  _user.reauthenticateWithCredential(cred).then(function(){
    return _user.updatePassword(nw);
  }).then(function(){
    RoxyUI.toast('✅ Şifreniz güncellendi!','success',4000);
    document.getElementById('oldPw').value='';
    document.getElementById('newPw').value='';
    document.getElementById('confPw').value='';
    document.getElementById('matchHint').textContent='';
    document.getElementById('pwReqs').classList.remove('show');
    btn.disabled=true;btn.innerHTML='<i class="fas fa-check"></i> Şifreyi Güncelle';
    closePwPanel();
  }).catch(function(e){
    btn.disabled=false;btn.innerHTML='<i class="fas fa-check"></i> Şifreyi Güncelle';
    var msg=e.code==='auth/wrong-password'?'Mevcut şifre hatalı.'
      :e.code==='auth/too-many-requests'?'Çok fazla deneme, lütfen bekleyin.'
      :'Hata: '+e.message;
    var errEl=document.getElementById('pwErrMsg');
    errEl.textContent=msg;errEl.style.display='block';
    document.getElementById('pwInfoMsg').style.display='none';
    setTimeout(function(){errEl.style.display='none';document.getElementById('pwInfoMsg').style.display='';},5000);
  });
}
</script>
</body>
</html>
